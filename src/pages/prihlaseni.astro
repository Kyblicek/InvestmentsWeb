---
import PageShell from '../components/PageShell.astro';

const user = Astro.locals.user;
if (user?.role === 'ADMIN') {
  return Astro.redirect('/admin');
}

const errorParam = Astro.url.searchParams.get('error');
const resetOk = Astro.url.searchParams.get('reset') === 'ok';

const errorMessage =
  errorParam === 'wrong'
    ? 'Špatné heslo, zkuste to znovu.'
    : errorParam === 'rate-limit'
      ? 'Příliš mnoho pokusů. Zkuste to později.'
      : null;

const seo = {
  title: 'Přihlášení | RRInvestments',
  description: 'Přístup do administrace RRInvestments pro správu obsahu a publikaci článků.',
  noIndex: true,
  breadcrumbs: [
    { name: 'Domů', url: '/' },
    { name: 'Přihlášení', url: Astro.url.pathname },
  ],
};
---
<PageShell {seo}>
  <section class="bg-[#f5f5f5] py-24">
    <div class="mx-auto flex w-full max-w-md flex-col gap-10 rounded-3xl bg-white p-10 shadow-lg">
      <header class="space-y-2 text-center">
        <h1 class="font-serif text-3xl">Přihlášení</h1>
        <p class="text-sm text-neutral-600">Použijte přístupové údaje správce.</p>
      </header>

      {resetOk && (
        <div class="rounded-md border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700">
          Heslo bylo úspěšně změněno. Přihlaste se novými údaji.
        </div>
      )}

      {errorMessage && (
        <div class="rounded-md border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700">
          {errorMessage}
        </div>
      )}

      <form method="post" action="/api/auth/login" class="space-y-6">
        <label class="block space-y-2">
          <span class="text-xs uppercase tracking-[0.3em] text-neutral-500">Email</span>
          <input
            type="email"
            name="email"
            required
            class="w-full rounded-lg border border-neutral-200 px-4 py-3 text-black outline-none focus:border-neutral-400"
            placeholder="admin@rrinvestments.eu"
          />
        </label>

        <label class="block space-y-2">
          <span class="text-xs uppercase tracking-[0.3em] text-neutral-500">Heslo</span>
          <input
            type="password"
            name="password"
            required
            class="w-full rounded-lg border border-neutral-200 px-4 py-3 text-black outline-none focus:border-neutral-400"
            placeholder="••••••••"
          />
        </label>

        <button
          type="submit"
          class="w-full rounded-full bg-black px-4 py-3 text-sm uppercase tracking-[0.3em] text-white transition hover:bg-neutral-700"
        >
          Přihlásit se
        </button>
      </form>
      <p class="text-center text-xs text-neutral-500">
        Potřebujete účet? Kontaktujte správce systému.
      </p>
      <p class="text-center text-xs text-neutral-500">
        Zapomněli jste heslo?{' '}
        <a href="/prihlaseni/reset" class="underline">
          Obnovit.
        </a>
      </p>
    </div>
  </section>
</PageShell>
